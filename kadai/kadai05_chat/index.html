<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>myMemoPad</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/trix.css" />
</head>

<body>
    <header>
        <h1 class="header_text">MemoPad(ãƒ†ãƒ¼ãƒ:æ€è€ƒã®ç™ºæ•£ã¨åæŸã‚’ç®¡ç†ã™ã‚‹)</h1>
    </header>

    <main>
        <div id="wrapper">
            <div id="leftwrapper">
                <p>All Document</p>
                <ul id="document_list">
                </ul>
                
            </div>

            <div id="centerwrapper">
                <p class="text_left">ã‚¿ã‚¤ãƒˆãƒ«</p>
                <input type="text" id="title">
                <p class="text_left">æœ¬æ–‡</p>
                <input type="hidden" value="" id="document" name="document">
                <ul class="ul">
                    <li id="document_save" class="li">Save</li>
                    <li id="document_clear" class="li">Clear</li>
                </ul>
                <trix-editor input="document" id="document_area"></trix-editor>
            </div>
            
            <div id="rightwrapper">
                <p>ã‚¿ã‚°</p>
                <input type="text" id="key">
                <p>memo</p>
                <textarea id="memo"></textarea>
                <ul class="ul"> 
                    <li id="save" class="li">Save</li>
                    <li id="clear" class="li">Clear</li>
                </ul>
                <div id="memo_list" style="overflow: auto;height:300px"></div>
            </div>
        </div>
    </main>


    <footer class="footer">
        <div class="wrapper">
        <small class="copyrights">copyrights 2022 Kohei Sumioka All RIghts Reserved.</small>
        </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/trix.js"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getDatabase, ref, push, set, onChildAdded, remove,onChildRemoved } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
    
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db =getDatabase(app);
        const dbRef=ref(db,"dev245");
        //â†‘ã“ã“ã¾ã§ã¯å¤‰æ›´ã—ãªã„

        //é€ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        $("#save").on("click",function(){
            const uname = $("#key").val();
            const text = $("#memo").val();
            
        
            //ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œã‚‹ï½¡msgã¨ã†åå‰ã§ä½œã‚‹.unameã¨ã„ã†ãªã¾ãˆ
        
            const msg={
                uname: uname,
                text: text,
            }
            const newPostRef = push( dbRef);
            set(newPostRef,msg)
    
            //é€ä¿¡å¾Œã«å…¥åŠ›æ¬„ã‚’æ®»ã«ã™ã‚‹
            $("#key").val("");
            $("#memo").val(""); 
        });
    
        //å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        onChildAdded(dbRef, function (data) {
                // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™
    
                // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
                const msg = data.val();
                console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
                const key = data.key;
                console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')
            
                //es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«
                let tag = `
                    <div class="msg">
                        <p>${msg.uname}</p>
                        <p>${msg.text}</p>
                    </div>    
                `;
                $("#memo_list").append(tag);
            })
    
            $("#memo_list").function
    
    
        </script>

</body>
</html>